#version 460

#include "denoise_m17.glsl"

void main() {
	ivec2 pos = ivec2(gl_GlobalInvocationID.xy);

	vec3 x_expected = imageLoad(historicalBuffer, pos).xyz;
	vec3 x_actual = imageLoad(rawImage, pos).xyz;

	float confidence = settings.historicalBlendingFactor * smoothstep(length(x_expected - x_actual));

	imageStore(confidenceBuffer, pos, vec4(confidence, 0.0, 0.0, 0.0));
}
